/*! ovh-angular-module-status - 3.0.0 - 2018-03-28 */
angular.module("ovh-angular-module-status",["ovh-api-services"]),angular.module("ovh-angular-module-status").config(["$stateProvider",function(a){a.state("status",{url:"/status",templateUrl:"app/module-status/status.html","abstract":!0})}]),angular.module("ovh-angular-module-status").service("StatusService",["$q","$translate","$translatePartialLoader","moment","OvhApiStatus",function(a,b,c,d,e){"use strict";var f=this;this.augmentStatus=function(a){var b=_.cloneDeep(a);return b.dateToShow=f.getDateToShow(a),b},this.getDateToShow=function(a){var b;if(a.endDate)b={display:d(a.endDate).format("ll, LTS"),date:a.endDate,unix:d(a.endDate).unix()};else if("maintenance"===a.type)b={display:d(a.startDate).format("ll, LTS"),date:a.startDate,unix:d(a.startDate).unix()};else if("incident"===a.type)if(a.replies.length>0){var c=_.last(a.replies);b={display:d(c.date).format("ll, LTS"),date:c.date,unix:d(c.date).unix()}}else b={display:d(a.startDate).format("ll, LTS"),date:a.startDate,unix:d(a.startDate).unix()};else b={display:d().format("ll, LTS"),date:d(),unix:d().unix()};return b},this.getCurrentStatus=function(a){return b.instant("status_"+a.type+"_"+a.status)},this.orderStatusNotification=function(a){return _.sortBy(a,function(a){return d(a.dateToShow.date)}).reverse()},this.getNotificationsMenu=function(){return c.addPart("ovh-angular-module-status"),a.all({translate:b.refresh(),tasks:e.Task().Lexi().query().$promise}).then(function(a){var c=_.map(a.tasks,function(a){return a.dateToShow=f.getDateToShow(a),a}),d=_.map(f.orderStatusNotification(c),function(a){return{title:a.title,url:"#/status/task/"+a.uuid,template:'<div class="clearfix"><div class="notification__title">'+a.title+'</div><div class="notification__date">'+a.dateToShow.display+'</div></div><div class="clearfix"><div class="notification__text">'+a.project+'</div><div class="notification__status">'+f.getCurrentStatus(a)+"</div></div>"}}),e='<h2 class="oui-navbar-menu__title">'+b.instant("status_menu_beta_title")+'</h2><p class="notification__intro">'+b.instant("status_intro")+'</p><a class="notification__email" href="mailto:feedbackstatus@corp.ovh.com">feedbackstatus@corp.ovh.com</a>';return{name:"notifications",title:b.instant("status_menu_title"),iconClass:"icon-notifications",limitTo:10,headerTemplate:e,footerTitle:b.instant("status_menu_see_all"),footerUrl:"#/status/task",subLinks:d,show:!0}})["catch"](function(){return a.resolve({show:!1})})}}]),angular.module("ovh-angular-module-status").config(["$stateProvider",function(a){a.state("status-task-alert",{url:"/status/task/alert",templateUrl:"app/module-status/task/alert/status-task-alert.html",translations:["common","module-status-task-alert"]})}]),angular.module("ovh-angular-module-status").controller("StatusTaskDetailCtrl",["OvhApiStatus","Toast","$stateParams","$translate",function(a,b,c,d){function e(){return f.loading.init=!0,a.Task().Lexi().query().$promise.then(function(a){return f.task=_.find(a,function(a){return a.uuid===f.currentTaskId}),f.task},function(a){return b.error([d.instant("status_task_detail_init_error"),a.data.message].join(" "))})["finally"](function(){f.loading.init=!1})}var f=this;this.loading={init:!0},this.currentTaskId=c.uuid,this.task=null,e()}]),angular.module("ovh-angular-module-status").config(["$stateProvider",function(a){a.state("status.task.detail",{url:"/{uuid}",views:{"headerStatusView@status":{templateUrl:"app/module-status/task/detail/status-detail-header.html"},"mainStatusView@status":{templateUrl:"app/module-status/task/detail/status-task-detail.html",controller:"StatusTaskDetailCtrl",controllerAs:"TaskDetail"}},translations:["common","module-status/task/detail"]})}]),angular.module("ovh-angular-module-status").config(["$stateProvider",function(a){a.state("status.task.list",{url:"/",views:{"headerStatusView@status":{templateUrl:"app/module-status/task/list/status-header.html"},"mainStatusView@status":{templateUrl:"app/module-status/task/list/status-task.html",controller:"StatusTaskCtrl",controllerAs:"StatusTask"}},translations:["common","module-status/task"]})}]),angular.module("ovh-angular-module-status").controller("StatusTaskCtrl",["$state","OvhApiStatus","StatusService","Toast","$translate",function(a,b,c,d,e){var f=this;this.tasks=void 0,f.getTasks=function(){return b.Task().Lexi().query().$promise.then(function(a){return f.tasks=_.map(a,c.augmentStatus),f.tasks=c.orderStatusNotification(f.tasks),{data:f.tasks,meta:{totalCount:f.tasks.length}}})["catch"](function(a){return d.error([e.instant("status_tasks_init_error"),a.data.message].join(" "))})},f.goSeeDetails=function(b){a.go("status.task.detail",{uuid:b})}}]),angular.module("ovh-angular-module-status").config(["$stateProvider",function(a){a.state("status.task",{url:"/task",redirectTo:"status.task.list",translations:["common","module-status/task"]})}]),angular.module("ovh-angular-module-status").run(["$templateCache",function(a){"use strict";a.put("app/module-status/status.html","<section><div data-ui-view=headerStatusView></div><main class=status-task-section-content role=main data-ui-view=mainStatusView></main></section>"),a.put("app/module-status/task/alert/status-task-alert.html",'<section class=header-section><header class=header-container role=banner><h1 translate=status_menu_title></h1><a class=section-back-link data-ui-sref=status-task><span><i class="ovh-font ovh-font-arrow-left" aria-hidden=""></i> <span data-translate="">Retour Ã  la liste</span></span></a></header></section><section><h2>SOON</h2></section>'),a.put("app/module-status/task/detail/status-detail-header.html",'<div class=status-section-header><header role=banner><h1 class=oui-header_1 translate=status_menu_title></h1><a class=section-back-link href="" data-ui-sref=status.task><span><i class="ovh-font ovh-font-arrow-left" aria-hidden=true></i> <span data-translate=status_task_detail_back></span></span></a></header></div>'),a.put("app/module-status/task/detail/status-task-detail.html",'<section data-ng-if=TaskDetail.loading.init class=text-center><spinner name=bubbles-222-fff-32></spinner><p data-translate=status_task_detail_loading_task></p></section><section data-ng-if="!TaskDetail.loading.init && TaskDetail.task"><div class="row bottom-space-m16"><div class=col-xs-12><h2 data-ng-bind=::TaskDetail.task.title></h2></div></div><div class="row bottom-space-m16"><div class="col-xs-8 col-lg-5"><h4><span data-ng-bind="(\'status_tasks_list_type_label_\' + TaskDetail.task.type) | translate"></span> - <span data-ng-bind=TaskDetail.task.project></span></h4></div><div class="col-xs-4 col-lg-7"><dl class="dl-horizontal status-task-dl"><dt data-translate=status_task_detail_id_label></dt><dd data-ng-bind=TaskDetail.task.reference></dd></dl></div></div><div class="row bottom-space-m16"><div class=col-xs-4><p class="label status-task__label status-task__label_normal" data-ng-bind="(\'status_tasks_list_status_label_\' + TaskDetail.task.status) | translate"></p><p class="label status-task__label" data-ng-class="{\n                \'status-task__label_major\': TaskDetail.task.impact === \'downtime\' || TaskDetail.task.impact === \'fullUnavailability\',\n                \'status-task__label_warning\': TaskDetail.task.impact === \'partialUnavailability\',\n                \'status-task__label_minor\': TaskDetail.task.impact === \'none\' || TaskDetail.task.impact === \'unknown\'\n            }" data-ng-bind="(\'status_tasks_list_impact_label_\' + TaskDetail.task.impact) | translate"></p></div></div><div class="row bottom-space-m16"><div class="col-xs-6 text-left"><dl class="dl-horizontal status-task-dl"><dt><span class="glyphicon glyphicon-time"></span> <span data-translate=status_tasks_detail_start></span></dt><dd data-ng-bind="TaskDetail.task.startDate | date:\'medium\'"></dd><dt data-ng-if=TaskDetail.task.endDate><span class="glyphicon glyphicon-time"></span> <span data-translate=status_tasks_detail_end></span></dt><dd data-ng-if=TaskDetail.task.endDate data-ng-bind="TaskDetail.task.endDate | date:\'medium\'"></dd></dl></div></div><div class="row bottom-space-m16"><div class=col-xs-12><p data-ng-bind=TaskDetail.task.details></p></div></div><div class="row bottom-space-m16"><div class=col-xs-12><h3 data-translate=status_task_detail_impacted_title></h3></div><div class=col-xs-12><p data-ng-bind=TaskDetail.task.impactedService></p></div></div><div class="row bottom-space-m16"><div class=col-xs-12><h3 data-translate=status_task_detail_reply_title></h3></div><div class=col-xs-12><div class=row data-ng-if=TaskDetail.task.replies.length data-ng-repeat="reply in TaskDetail.task.replies"><div class="col-xs-12 col-md-8 col-lg-5 status-task-detail-reply"><p data-ng-bind=reply.comment></p><small class=text-muted data-ng-bind="reply.date | date:\'medium\'"></small></div></div><div class=row data-ng-if=!TaskDetail.task.replies.length><div class="col-xs-12 col-md-8 col-lg-5 status-task-detail-reply text-center"><p data-translate=status_task_detail_no_reply></p></div></div></div></div></section>'),a.put("app/module-status/task/list/status-header.html",'<div class=status-section-header><header role=banner><h1 class=oui-header_1 translate=status_menu_title></h1></header><nav role=navigation><responsive-tabs><responsive-tab data-state="{{ ::\'status.task\' }}" dropdown-title="{{\'status_tasks_list_title\'|translate}}"><span data-translate=status_tasks_list_title></span></responsive-tab><responsive-tab-more><i class="fa fa-plus"></i></responsive-tab-more></responsive-tabs></nav></div>'),a.put("app/module-status/task/list/status-task.html",'<section><oui-datagrid data-rows-loader=StatusTask.getTasks()><oui-column data-title="\'status_tasks_list_title_title\' | translate" data-property=project data-sortable>{{ "status_tasks_list_product_label_" + $row.project | translate }}</oui-column><oui-column data-title="\'status_tasks_list_type_title\' | translate" data-property=type data-sortable=desc>{{ "status_tasks_list_type_label_" + $row.type | translate }}</oui-column><oui-column data-title="\'status_tasks_list_state_title\' | translate" data-property=status data-sortable=desc>{{ "status_tasks_list_status_label_" + $row.status | translate }}</oui-column><oui-column data-title="\'status_tasks_list_date_title\' | translate" data-property=dateToShow.display data-sortable></oui-column><oui-column data-title="\'status_tasks_list_details_title\' | translate" data-property=title data-sortable></oui-column><oui-action-menu data-align=end data-compact><oui-action-menu-item data-text="{{\'status_tasks_list_see_more\' | translate}}" data-on-click=StatusTask.goSeeDetails($row.uuid)></oui-action-menu-item></oui-action-menu></oui-datagrid></section>')}]);